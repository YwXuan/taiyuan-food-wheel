<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>台元科技園區｜午餐美食轉盤 </title>
<meta name="description" content="台元科技園區美食轉盤。支援期別、素食、關鍵字、距離排序/上限、料理類別、價位篩選與 CSV 匯出。">
<style>
  :root{--bg:#0f1220;--panel:#171a2b;--card:#1f2340;--text:#e8ecff;--muted:#b6b9d8;--accent:#6ea8fe;--warn:#ffb86b}
  *{box-sizing:border-box}
  body{margin:0;background:radial-gradient(1200px 800px at 20% -20%, #1b2145 0%, #0f1220 60%);color:var(--text);
       font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI","Noto Sans TC","PingFang TC","Helvetica Neue",Arial}
  header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid #2b3054;background:rgba(0,0,0,.2);backdrop-filter: blur(6px);position:sticky;top:0;z-index:10}
  header h1{margin:0;font-size:18px}.sub{color:var(--muted);font-size:12px}
  main{display:grid;grid-template-columns:340px 1fr;gap:12px;padding:12px;max-width:1200px;margin:0 auto}
  @media (max-width: 900px){ main{grid-template-columns:1fr} }
  .panel{background:var(--panel);border:1px solid #2b3054;border-radius:14px;padding:12px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
  .panel h2{margin:6px 0 8px;font-size:16px}
  .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid #2b3054;background:#21264a;color:var(--text);
       padding:8px 12px;border-radius:10px;cursor:pointer;font-size:14px;transition:.15s transform ease,.15s box-shadow ease}
  .btn:hover{transform:translateY(-1px);box-shadow:0 8px 16px rgba(0,0,0,.25)}
  .btn.primary{background:linear-gradient(135deg,#3b5bff,#6ea8fe);border-color:transparent}
  .btn.small{font-size:12px;padding:6px 10px}
  .chips{display:flex;flex-wrap:wrap;gap:8px}.chip{padding:6px 10px;border:1px solid #2b3054;border-radius:999px;color:var(--muted);cursor:pointer}
  .chip.active{background:#2b3054;color:var(--text)}
  .muted{color:var(--muted)} .stack{display:flex;gap:8px;flex-wrap:wrap} .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .grid{display:grid;grid-template-columns:1.1fr 1fr;gap:12px} @media (max-width: 900px){.grid{grid-template-columns:1fr}}
  #wheelCanvas{width:min(90vw,560px);height:min(90vw,560px);background:conic-gradient(from 0deg,#1b1f3a,#252a52);
               border-radius:50%;border:10px solid #2b3054;box-shadow:inset 0 0 80px rgba(0,0,0,.3),0 20px 40px rgba(0,0,0,.35)}
  .pointer{width:0;height:0;border-left:14px solid transparent;border-right:14px solid transparent;border-bottom:22px solid var(--warn);filter:drop-shadow(0 3px 0 rgba(0,0,0,.4));margin-top:-6px}
  table{width:100%;border-collapse:collapse;font-size:13px} th,td{padding:8px 10px;border-bottom:1px dashed #2b3054;text-align:left}
  th{color:#cbd0ff} .phase{padding:.15em .5em;border-radius:999px;background:#2b3054}
  footer{padding:14px;text-align:center;color:#8085b0}
  input[type="search"],select,input[type="number"]{padding:8px 10px;border-radius:8px;border:1px solid #2b3054;background:#121633;color:#e8ecff}
  input[type="range"]{width:100%}
  .tag{display:inline-flex;align-items:center;gap:6px;padding:.18rem .5rem;border-radius:999px;border:1px solid #2b3054;color:#cbd0ff;font-size:12px}
  .card{background:var(--card);border:1px solid #2b3054;border-radius:10px;padding:10px}
</style>
</head>
<body>
<header>
  <div>
    <h1>台元科技園區｜午餐美食轉盤</h1>
    <div class="sub">支援距離 / 料理類別 / 價位篩選</div>
  </div>
  <div class="stack">
    <button class="btn small" id="btnExport">匯出 CSV</button>
    <button class="btn small" id="btnReset">重設</button>
  </div>
</header>

<main>
  <aside class="panel">
    <h2>篩選</h2>
    <div class="row"><div class="muted">期別</div><div class="chips" id="phaseChips"></div></div>
    <div class="row" style="margin-top:6px">
      <label class="row"><input type="checkbox" id="onlyMeals"> 只看正餐</label>
      <label class="row"><input type="checkbox" id="onlyVeg"> 可素食</label>
    </div>
    <div class="row" style="margin-top:6px">
      <select id="cat">
        <option value="">料理類別（全部）</option>
        <option>台式</option><option>便當</option><option>麵食</option><option>拉麵</option>
        <option>韓式</option><option>咖哩</option><option>素食</option><option>輕食</option>
        <option>炸物</option><option>咖啡</option><option>早餐</option><option>飲料</option><option>果汁</option>
      </select>
      <select id="price">
        <option value="">價位（全部）</option>
        <option>$</option><option>$$</option><option>$$$</option>
      </select>
    </div>
    <div style="margin-top:6px" class="row">
      <input id="q" type="search" placeholder="關鍵字（如 咖哩 / 便當 / SUBWAY）" style="flex:1">
      <button class="btn" id="btnApply">套用</button>
    </div>
    <hr style="border-color:#2b3054;border-style:solid;border-width:1px 0 0;margin:12px 0">
    <h2>距離</h2>
    <div class="row">
      <button class="btn small" id="btnUseGPS">用目前位置</button>
      <select id="myPhase">
        <option value="">或選我的期別當起點</option>
        <option value="1">1 期 一期豪華商務會館</option>
        <option value="2">2 期 Mini Mart</option>
        <option value="3">3 期 Food Center / 文化會館</option>
        <option value="5">5 期 名仕健身會館</option>
        <option value="6">6 期 台元二街1號</option>
        <option value="8">8 期 W 會館</option>
        <option value="9">9 期 Z 棟</option>
      </select>
    </div>
    <div class="row" style="margin-top:6px">
      <div class="muted" style="min-width:5em">上限</div>
      <input type="range" id="maxDist" min="100" max="1200" step="50" value="1200">
      <span id="maxDistLabel" class="muted">≤ 1200 m</span>
    </div>
    <div class="row" style="margin-top:6px">
      <div class="muted" style="min-width:5em">排序</div>
      <select id="sortBy">
        <option value="distance">距離（近→遠）</option>
        <option value="name">名稱（A→Z）</option>
        <option value="phase">期別（小→大）</option>
      </select>
    </div>
    <div class="card" style="margin-top:8px">
      <div class="muted" id="myLocLabel">起點：未設定（距離排序功能受限）</div>
      <div class="muted" style="margin-top:4px">提醒：若用 <code>file://</code> 開啟，GPS 可能被擋；用 GitHub Pages / Netlify（HTTPS）即可。</div>
    </div>
  </aside>

  <section class="grid">
    <div class="panel">
      <div style="display:grid;place-items:center;gap:8px">
        <canvas id="wheelCanvas" width="560" height="560"></canvas>
        <div class="pointer"></div>
        <div class="stack">
          <button class="btn primary" id="btnSpin">🎯 開抽！</button>
          <button class="btn" id="btnShuffle">重新洗牌</button>
        </div>
        <div id="result" class="muted">按「開抽！」開始轉盤</div>
      </div>
    </div>
    <div class="panel">
      <div class="row" style="justify-content:space-between">
        <strong>目前候選名單</strong>
        <div class="tag" id="countRow">—</div>
      </div>
      <div class="card" style="max-height:420px;overflow:auto;margin-top:8px">
        <table id="listTbl"><thead><tr><th>餐廳</th><th>期</th><th>地址</th><th>類型</th><th>類別</th><th>價位</th><th>距離</th></tr></thead><tbody></tbody></table>
      </div>
    </div>
  </section>
</main>

<footer>來源：台元科技園區「園區店家」官方列表（期別館）。距離為近似估算（以期別中心點代表位置）。</footer>

<script>
// === Phase 中心點（近似） ===
const phaseCenters = {
  1:[24.8289,121.0168], 2:[24.8296,121.0179], 3:[24.8298,121.0148],
  5:[24.8307,121.0134], 6:[24.8309,121.0170], 8:[24.8292,121.0198], 9:[24.8297,121.0215],
};

// === 餐廳資料（新增 cat, price）===
const DATA = [
  // 1 期
  {name:"長鮮舒肥廚房", phase:1, addr:"台元街26-6號(一期豪華商務會館)", type:"正餐", veg:false, cat:"台式", price:"$$"},
  {name:"cama cafe 台元科技店", phase:1, addr:"台元街26-9號之2(一期豪華商務會館)", type:"咖啡", veg:false, cat:"咖啡", price:"$"},
  {name:"康青龍 台元店", phase:1, addr:"台元街26-9號之1(一期豪華商務會館)", type:"飲料", veg:false, cat:"飲料", price:"$"},
  {name:"美而美 台元店", phase:1, addr:"台元街26-9號之1(一期豪華商務會館)", type:"早餐", veg:false, cat:"早餐", price:"$"},
  {name:"SUBWAY 台元一店", phase:1, addr:"台元街26-11號(一期豪華商務會館1樓)", type:"輕食", veg:true, cat:"輕食", price:"$"},
  {name:"源士林粥品", phase:1, addr:"台元街26號2樓(一期豪華商務會館)", type:"正餐", veg:false, cat:"台式", price:"$"},
  {name:"品圓", phase:1, addr:"台元街26號2樓(一期豪華商務會館)", type:"正餐", veg:false, cat:"台式", price:"$"},
  {name:"拾糧 蔬食料理", phase:1, addr:"台元街26號2樓(一期豪華商務會館)", type:"素食", veg:true, cat:"素食", price:"$"},
  {name:"皇樓燒臘", phase:1, addr:"台元街26號2樓(一期豪華商務會館)", type:"正餐", veg:false, cat:"便當", price:"$"},
  {name:"三喜屋", phase:1, addr:"台元街26號2樓(一期豪華商務會館)", type:"正餐", veg:false, cat:"台式", price:"$"},
  // 2 期
  {name:"星巴克 台元門市", phase:2, addr:"台元街34號(二期會館)", type:"咖啡", veg:false, cat:"咖啡", price:"$"},
  {name:"鼎豐園", phase:2, addr:"台元街34號(Mini Mart)", type:"正餐", veg:false, cat:"台式", price:"$$"},
  {name:"承運世家", phase:2, addr:"台元街34號(Mini Mart)", type:"正餐", veg:false, cat:"台式", price:"$"},
  {name:"好呷味食堂", phase:2, addr:"台元街34號(Mini Mart)", type:"正餐", veg:false, cat:"台式", price:"$"},
  // 3 期
  {name:"三商巧福", phase:3, addr:"台元一街7號(三期 Food Center)", type:"正餐", veg:false, cat:"台式", price:"$"},
  {name:"八方雲集（三期）", phase:3, addr:"台元一街7號(三期 Food Center)", type:"正餐", veg:false, cat:"麵食", price:"$"},
  {name:"韓國館", phase:3, addr:"台元一街7號(三期 Food Center)", type:"正餐", veg:false, cat:"韓式", price:"$$"},
  {name:"妙蓮素食", phase:3, addr:"台元一街7號(三期 Food Center)", type:"素食", veg:true, cat:"素食", price:"$"},
  {name:"榮茂魯肉飯", phase:3, addr:"台元一街7號(三期 Food Center)", type:"正餐", veg:false, cat:"便當", price:"$"},
  {name:"炸雞大獅", phase:3, addr:"台元一街7號(三期 Food Center)", type:"炸物", veg:false, cat:"炸物", price:"$"},
  {name:"金雲大餛飩", phase:3, addr:"台元一街7號(三期 Food Center)", type:"麵食", veg:false, cat:"麵食", price:"$"},
  {name:"The Greenery 蔬坊", phase:3, addr:"台元一街7號(三期 Food Center)", type:"輕食", veg:true, cat:"輕食", price:"$"},
  {name:"85度C 竹北台元店", phase:3, addr:"台元一街7號(三期 Food Center)", type:"咖啡", veg:false, cat:"咖啡", price:"$"},
  {name:"SUBWAY 台元店（三期）", phase:3, addr:"台元一街3號之1(三期文化會館)", type:"輕食", veg:true, cat:"輕食", price:"$"},
  {name:"萃茶風 大享食", phase:3, addr:"台元一街3號(三期文化會館)", type:"丼飯/烏龍麵", veg:false, cat:"台式", price:"$"},
  // 5 期
  {name:"SABROSA 花園餐廳", phase:5, addr:"台元一街2號(五期會館)", type:"正餐", veg:false, cat:"西式", price:"$$$"},
  {name:"星巴克 台元二門市", phase:5, addr:"台元一街2號(五期會館)", type:"咖啡", veg:false, cat:"咖啡", price:"$"},
  // 6 期
  {name:"五花馬水餃館", phase:6, addr:"台元二街1號2樓(六期)", type:"麵食", veg:false, cat:"麵食", price:"$"},
  // 8 期
  {name:"梁社漢排骨", phase:8, addr:"台元二街7號1樓(八期 W 會館)", type:"便當", veg:false, cat:"便當", price:"$"},
  {name:"熊禾屋日式咖哩", phase:8, addr:"台元二街7號1樓(八期 W 會館)", type:"咖哩", veg:false, cat:"咖哩", price:"$"},
  {name:"八方雲集（八期）", phase:8, addr:"台元二街7號1樓(八期 W 會館)", type:"正餐", veg:false, cat:"麵食", price:"$"},
  {name:"榮益雞肉飯", phase:8, addr:"台元二街7號1樓(八期 W 會館)", type:"便當", veg:false, cat:"便當", price:"$"},
  // 9 期
  {name:"悠鮮果物", phase:9, addr:"台元二街16號1樓(九期 Z 棟)", type:"果汁/輕食", veg:true, cat:"果汁", price:"$"},
  {name:"滝禾製麵所（九期）", phase:9, addr:"台元二街16號1樓(九期 Z 棟)", type:"拉麵", veg:false, cat:"拉麵", price:"$$"},
  {name:"朝正泰 南洋料理", phase:9, addr:"台元二街16號1樓(九期 Z 棟)", type:"南洋", veg:false, cat:"咖哩", price:"$$"},
  {name:"四海遊龍（九期）", phase:9, addr:"台元二街16號1樓(九期 Z 棟)", type:"鍋貼/水餃", veg:false, cat:"麵食", price:"$"},
  {name:"豐米便當（九期）", phase:9, addr:"台元二街16號1樓(九期 Z 棟)", type:"便當", veg:false, cat:"便當", price:"$"},
];

// === 狀態 ===
let state={ phases:new Set([1,2,3,5,6,8,9]), onlyMeals:false, onlyVeg:false, cat:"", price:"", myLoc:null, maxDist:1200, sortBy:"distance" };

// === 距離工具 ===
const toRad=d=>d*Math.PI/180;
function haversine(a,b){ if(!a||!b) return null; const [lat1,lon1]=a,[lat2,lon2]=b; const R=6371000;
  const dLat=toRad(lat2-lat1), dLon=toRad(lon2-lon1);
  const s=Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
  return 2*R*Math.asin(Math.sqrt(s));
}
const asMeters=m=>m==null?"—":(m<1000?`${Math.round(m)} m`:`${(m/1000).toFixed(2)} km`);

// === 資料過濾 ===
function getFiltered(){
  const q=document.getElementById('q').value.trim();
  const words=q? q.split(/\s+/):[];
  let arr=DATA.filter(d=>state.phases.has(d.phase))
              .filter(d=>!state.onlyMeals || (d.type!=="咖啡"&&d.type!=="飲料"&&d.type!=="甜點"&&d.type!=="果汁/輕食"&&d.type!=="早餐"))
              .filter(d=>!state.onlyVeg || d.veg)
              .filter(d=>!state.cat || d.cat===state.cat)
              .filter(d=>!state.price || d.price===state.price)
              .filter(d=>!words.length || words.every(w=>(d.name+d.addr+d.type+d.cat).includes(w)))
              .map(d=>({...d, coord:phaseCenters[d.phase]}));
  arr=arr.map(d=>({...d, dist: state.myLoc&&d.coord? haversine(state.myLoc,d.coord):null}));
  if(state.myLoc){ arr=arr.filter(d=>d.dist==null || d.dist<=state.maxDist); }
  if(state.sortBy==='distance'){ arr.sort((a,b)=>(a.dist??1e15)-(b.dist??1e15)); }
  else if(state.sortBy==='name'){ arr.sort((a,b)=>a.name.localeCompare(b.name,'zh-Hant')); }
  else if(state.sortBy==='phase'){ arr.sort((a,b)=>a.phase-b.phase || a.name.localeCompare(b.name,'zh-Hant')); }
  return arr;
}

// === UI ===
function renderPhaseChips(){
  const host=document.getElementById('phaseChips'); host.innerHTML='';
  [1,2,3,5,6,8,9].forEach(p=>{
    const el=document.createElement('div'); el.className='chip'+(state.phases.has(p)?' active':''); el.textContent=p+'期';
    el.onclick=()=>{ if(state.phases.has(p)) state.phases.delete(p); else state.phases.add(p); renderPhaseChips(); apply(); };
    host.appendChild(el);
  });
}
function updateList(){
  const data=getFiltered(), tb=document.querySelector('#listTbl tbody'); tb.innerHTML='';
  for(const d of data){
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${d.name}</td><td><span class="phase">${d.phase}</span></td><td>${d.addr}</td><td>${d.type}</td><td>${d.cat}</td><td>${d.price}</td><td>${asMeters(d.dist)}</td>`;
    tb.appendChild(tr);
  }
  document.getElementById('countRow').textContent = `共 ${data.length} 家`;
}
// 轉盤
let currentAngle=0, labels=[]; function buildWheel(){
  const items=getFiltered().slice(); labels=items.map(d=>d.name);
  const canvas=document.getElementById('wheelCanvas'), ctx=canvas.getContext('2d'); const W=canvas.width,H=canvas.height; const cx=W/2,cy=H/2,r=W/2-16;
  ctx.clearRect(0,0,W,H); const n=Math.max(labels.length,1), slice=2*Math.PI/n;
  for(let i=0;i<n;i++){ const a0=i*slice+currentAngle,a1=a0+slice; const hue=(i*360/n+20)%360;
    ctx.beginPath(); ctx.moveTo(cx,cy); ctx.arc(cx,cy,r,a0,a1); ctx.closePath(); ctx.fillStyle=`hsl(${hue} 65% 45%)`; ctx.fill();
    ctx.strokeStyle="rgba(0,0,0,.25)"; ctx.lineWidth=1.2; ctx.stroke();
    ctx.save(); ctx.translate(cx,cy); ctx.rotate(a0+slice/2); ctx.textAlign="right"; ctx.fillStyle="#fff"; ctx.font="14px ui-sans-serif, system-ui, -apple-system, 'Noto Sans TC'";
    ctx.fillText(labels[i]||"（無）", r-10, 4); ctx.restore();
  }
}
let spinning=false; function spin(){
  if(spinning || labels.length===0) return; spinning=true;
  const n=labels.length, slice=2*Math.PI/n; const targetIndex=Math.floor(Math.random()*n);
  const targetAngle=(3*Math.PI/2)-(targetIndex*slice+slice/2); const extraTurns=4+Math.floor(Math.random()*3); const finalAngle=targetAngle+extraTurns*2*Math.PI;
  const duration=3200+Math.random()*1200, start=performance.now(), startAngle=currentAngle;
  const animate=now=>{ const t=Math.min(1,(now-start)/duration), ease=1-Math.pow(1-t,3);
    currentAngle=startAngle+(finalAngle-startAngle)*ease; buildWheel();
    if(t<1) requestAnimationFrame(animate); else{ spinning=false; currentAngle=((currentAngle%(2*Math.PI))+2*Math.PI)%(2*Math.PI);
      let idx=Math.round(((3*Math.PI/2-currentAngle)/slice)-0.5); idx=((idx%n)+n)%n; const picked=labels[idx]; showResult(picked); } };
  requestAnimationFrame(animate);
}
function showResult(name){
  const item=getFiltered().find(d=>d.name===name) || DATA.find(d=>d.name===name);
  const host=document.getElementById('result'); if(!item){ host.textContent="（找不到項目）"; return; }
  const mapQ=encodeURIComponent(`${item.name} ${item.addr}`), url=`https://www.google.com/maps/search/?api=1&query=${mapQ}`;
  const distLabel=state.myLoc? asMeters(haversine(state.myLoc, phaseCenters[item.phase])): "—";
  host.innerHTML = `<div class="tag">抽中了</div>
    <div style="font-size:20px;margin:4px 0">${item.name}</div>
    <div class="muted">${item.addr}　<span class="phase">${item.phase}期</span>　｜ ${item.cat}・${item.price} ｜ 距離 ${distLabel}</div>
    <div class="stack" style="margin-top:8px"><a class="btn" target="_blank" rel="noopener" href="${url}">在 Google 地圖開啟</a>
    <button class="btn" onclick="navigator.clipboard.writeText('${item.name} - ${item.addr}')">複製名稱＋地址</button>
    <button class="btn" onclick="spin()">不服再抽一次</button></div>`;
}

// 匯出
function exportCSV(){
  const rows=[["餐廳","期別","地址","型態","可素食","類別","價位","距離(m)"]]
    .concat(getFiltered().map(d=>[d.name,d.phase,d.addr,d.type,d.veg?"是":"否",d.cat,d.price,d.dist?Math.round(d.dist):""]));
  const csv=rows.map(r=>r.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(",")).join("\n");
  const url=URL.createObjectURL(new Blob([csv],{type:"text/csv;charset=utf-8;"}));
  const a=document.createElement('a'); a.href=url; a.download="taiyuan-food-list.csv"; a.click(); setTimeout(()=>URL.revokeObjectURL(url),3000);
}

// 綁定
function apply(){ updateList(); buildWheel(); }
document.getElementById('btnApply').onclick=apply;
document.getElementById('btnSpin').onclick=spin;
document.getElementById('btnShuffle').onclick=()=>{ currentAngle=0; buildWheel(); };
document.getElementById('btnReset').onclick=()=>{
  state={ phases:new Set([1,2,3,5,6,8,9]), onlyMeals:false, onlyVeg:false, cat:"", price:"", myLoc:null, maxDist:1200, sortBy:"distance" };
  document.getElementById('onlyMeals').checked=false; document.getElementById('onlyVeg').checked=false;
  document.getElementById('q').value=""; document.getElementById('cat').value=""; document.getElementById('price').value="";
  document.getElementById('myPhase').value=""; document.getElementById('sortBy').value="distance"; document.getElementById('maxDist').value=1200;
  document.getElementById('maxDistLabel').textContent="≤ 1200 m"; document.getElementById('myLocLabel').textContent="起點：未設定（距離排序功能受限）"; renderPhaseChips(); apply();
};
document.getElementById('onlyMeals').onchange=e=>{ state.onlyMeals=e.target.checked; apply(); };
document.getElementById('onlyVeg').onchange=e=>{ state.onlyVeg=e.target.checked; apply(); };
document.getElementById('cat').onchange=e=>{ state.cat=e.target.value; apply(); };
document.getElementById('price').onchange=e=>{ state.price=e.target.value; apply(); };
document.getElementById('sortBy').onchange=e=>{ state.sortBy=e.target.value; apply(); };
document.getElementById('maxDist').oninput=e=>{ state.maxDist=+e.target.value; document.getElementById('maxDistLabel').textContent = `≤ ${state.maxDist} m`; apply(); };
document.getElementById('btnUseGPS').onclick=()=>{
  if(!navigator.geolocation){ alert("此瀏覽器不支援定位。可改用『我的期別』設定起點。"); return; }
  navigator.geolocation.getCurrentPosition(pos=>{
    state.myLoc=[pos.coords.latitude, pos.coords.longitude];
    document.getElementById('myPhase').value="";
    document.getElementById('myLocLabel').textContent=`起點：GPS 已設定（${pos.coords.latitude.toFixed(5)}, ${pos.coords.longitude.toFixed(5)}）`;
    apply();
  }, _=> alert("無法取得定位（需要 HTTPS 或權限被拒）。可用『我的期別』設定起點。"), {enableHighAccuracy:true, timeout:8000, maximumAge:60000});
};
document.getElementById('myPhase').onchange=e=>{
  const p=+e.target.value;
  if(p){ state.myLoc=phaseCenters[p]; document.getElementById('myLocLabel').textContent=`起點：${p} 期中心點（近似）`; }
  else{ state.myLoc=null; document.getElementById('myLocLabel').textContent="起點：未設定（距離排序功能受限）"; }
  apply();
};
document.getElementById('q').addEventListener('keydown',e=>{ if(e.key==="Enter") apply(); });

// init
renderPhaseChips(); apply();
</script>
</body>
</html>
